<!doctype html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
		<title>新增楼盘</title>
		<link href="resourse_css_reset.css" type="text/css" rel="styleSheet" />
		<link rel="styleSheet" type="text/css" href="resourse_css_register.css">
		<link href="lxs_css_lxs.css" type="text/css" rel="styleSheet" />
		<link href="resourse_css_mobilebone.css" type="text/css" rel="styleSheet" />
		<link href="resourse_css_iSlider.css" type="text/css" rel="styleSheet" />
		<link href="resourse_css_mobilebone.animate.css" type="text/css" rel="styleSheet" />
		<script src="resourse_scripts_jquery-1.8.3.js"></script>
		<style>
			body{
				min-height: 100%;
			}
			
			.search_condition .condition {
				margin-left: 70px;
			}
			
			#price_unit {
				float: right;
			}
			
			.bottom {
				width: 100%;
				display: inline;
				position: fixed;
				font-size: 16px;
				left: 0px;
				bottom: 10px;
			}
			
			.submitAdd {
				color: #fff;
				border: 1px solid #bd081c;
				background: #bd081c;
				float: left;
				position: relative;
				text-decoration: none;
				width: 80%;
				margin-left: 10%;
				text-align: center;
				height: 45px;
				border-radius: 5px;
				line-height: 45px;
				margin-right: 10px;
				top: 3px;
			}
			
			.img_con {
				margin-left: 50px;
				max-width: 222px;
			}
			
			.add_img {
				margin-top: 10px;
				background: url(fangyuan_images_add_img.png) no-repeat;
				background-size: 100%;
				width: 64px;
				height: 64px;
				float: left;
				margin-left: 10px;
				margin-bottom: 10px;
			}
			
			.img_span {
				width: 64px;
				height: 64px;
				float: left;
				margin-left: 10px;
				overflow: hidden;
				margin-bottom: 10px;
				position: relative;
			}
			
			.img_span img {
				width: 100%;
				height: 100%;
			}
			
			.img_del {
				background: url(fangyuan_images_del_img.png) no-repeat;
				height: 16px;
				width: 16px;
				position: absolute;
				right: 0;
				top: 0;
				background-size: 100%;
			}
			
			.img_con {
				margin-left: 50px;
				max-width: 222px;
			}
		</style>
	</head>

	<body>
		<div class="page out" id="index" data-fallback="detailFallback">
			<div class="top_banner" style="background: #e7e7e7;">
				<a href="javascript:app.goBack();" class="go_back" data-rel="back"><i></i></a>
				<p class="title">新增楼盘</p>
			</div>
			<div class="content" id="search_scroller" style="top: 60px; bottom: 60px; overflow: auto;">
				<div class="scroller_inner" style="transform-origin: 0px 0px 0px; position: absolute; top: 0px; left: 0px;">
					<div class="search_condition">
						<div class="line">
							<span class="condition_name">楼盘名称</span>
							<div class="condition">
								<input type="text" class="condition_ipt" id="house_name" placeholder="">
							</div>
						</div>
						<div class="line">
							<span class="condition_name">楼盘地址</span>
							<div class="condition">
								<input type="text" class="condition_ipt" id="house_address" placeholder="">
							</div>
						</div>
						<div class="line">
							<span class="condition_name">楼盘类型</span>
							<div class="condition">
								<a id="house_type" class="select_condition clearfix" href="#select">
									<i></i>
									<p id="buildType" tid="">全部</p>
								</a>
							</div>
						</div>
						<div class="line">
							<span class="condition_name">租金报价(区间)</span>
							<div class="condition">
								<input type="text" style="margin-left: 40px;" class="condition_ipt" id="rent_price" placeholder="¥"><span id="price_unit">元/m²/天</span>
							</div>
						</div>
						<div class="line">
							<span class="condition_name">平均售价</span>
							<div class="condition">
								<input type="text" class="condition_ipt" id="ave_sel_price" placeholder="¥"><span id="price_unit">元/m²</span>
							</div>
						</div>
						<div class="line">
							<span class="condition_name">物业费</span>
							<div class="condition">
								<input type="text" class="condition_ipt" id="pm_fee" placeholder="¥"><span id="price_unit">元/m²/月</span>
							</div>
						</div>
						<div class="line">
							<span class="condition_name">楼盘介绍</span>
							<div class="condition">
								<a id="house_introduce" class="select_condition clearfix" href="#summary">
									<i></i>
									<p></p>
								</a>
							</div>
						</div>
						<div class="line" style="height: auto; ">
							<div class="other_imgs" id="other_imgs">
								<span class="img_type_name">上传楼盘图片</span>
								<div class="img_con clearfix">
									<a href="javascript:app.upload(2,null,1,2);" class="add_img" id="add_image" imgt="images"></a>
								</div>
							</div>
						</div>
					</div>

					<div class="bottom">
						<a href="#index" class="submitAdd" data-rel="back" id="add_house">提交</a>
					</div>
				</div>
			</div>
		</div>

		<div class="page out" id="summary">
			<div class="top_banner graybg">
				<a href="javascript:;" data-rel="back" class="go_back"><i></i></a>
				<p class="title">楼盘介绍</p>
				<a href="javascript:;" style="margin-top: -40px;" id="submit_intro" class="submit" data-rel="back"><i></i></a>
			</div>
			<div class="content" style="background: #fff;">
				<div class="house_desc"><textarea placeholder="请输入楼盘简介!" maxlength="200" class="text_area" id="build_area"></textarea></div>
			</div>
		</div>

		<div class="page out" id="select">
			<div class="select_area">
				<div class="top_banner">
					<a href="#index" class="go_back" data-rel="back"><i></i></a>
					<a href="javascript:;" id="submit_type" class="submit" data-rel="back"><i></i></a>
					<p class="title" id="select_type">类型选择</p>
				</div>
				<div class="content" id="select_scroller" style="top: 60px; overflow: hidden;">
					<div class="scroller_inner" style="transform-origin: 0px 0px 0px; position: absolute; top: 0px; left: 0px;">
						<div id="options">
							<div class="areas">
								<label class="checkbox area">
									<input type="radio" name="type" value="1">
									<span class="is_check right"></span>
									<span class="checkbox_title">顶级写字楼</span>
								</label>
								<label class="checkbox area">
									<input type="radio" name="type" value="2">
									<span class="is_check right"></span>
									<span class="checkbox_title">甲级写字楼</span>
								</label>
								<label class="checkbox area">
									<input type="radio" name="type" value="3">
									<span class="is_check right"></span>
									<span class="checkbox_title">乙级写字楼</span>
								</label>
								<label class="checkbox area">
									<input type="radio" name="type" value="4">
									<span class="is_check right"></span>
									<span class="checkbox_title">丙级写字楼</span>
								</label>
								<label class="checkbox area">
									<input type="radio" name="type" value="5">
									<span class="is_check right"></span>
									<span class="checkbox_title">商住楼</span>
								</label><label class="checkbox area">
									<input type="radio" name="type" value="6">
									<span class="is_check right"></span>
										<span class="checkbox_title">产业园区</span>
								</label>
								<label class="checkbox area">
									<input type="radio" name="type" value="7">
									<span class="is_check right"></span>
									<span class="checkbox_title">洋房别墅</span>
								</label>
								<label class="checkbox area">
									<input type="radio" name="type" value="8">
									<span class="is_check right"></span>
									<span class="checkbox_title">创意园区</span>
								</label>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
//		        window.location.reload();
		
			window.onload = function() {
				$("#submit_type").on('click', function() {
					var inputs = $("input[type='radio']:checked");
					var content = $(inputs).parent().find(".checkbox_title").text();
					$("#buildType").text(content);
					$("#buildType").attr('tid', $(inputs).val());
				});
				$("#build_area").val(localStorage.getItem('house_introduce'));
				$("#submit_intro").on('click', function() {
					localStorage.setItem('house_introduce', $("#build_area").val());
				});

				var uploadCallBack = function(id, url) {
					addImages(id, url);
				}

				function addImages(id, url) {
					var html = util.tpl.apply('img', {
						imgType: 'images',
						avatar: url,
						id: id
					});
					var newIn = $(html);
					$('#add_image').before(newIn);
					if($('#other_imgs .img_span').size() >= 10) {
						$('#add_image').hide();
					}
					$('.img_del').unbind().click(function(e) {
						$(this).parent().remove();
						if($('#room_cover .img_span').size() == 0) {
							$('#add_cover').show();
						}
						if($('#other_imgs .img_span').size() < 10) {
							$('#add_image').show();
						}
					})
				}
				window.addImages = addImages;
				window.uploadCallBack = uploadCallBack;

				var add_house_url = "https://appapi.imrlou.com/api/insertnewbuilding";
				//确认按钮
				$('#add_house').on('click', function() {
					var name_len = $("#house_name").val().length;
					var add_len = $("#house_address").val().length;
					var type_len = $("#buildType").text();
					if(name_len == 0) {
						alert("楼盘名称不可为空");
						return false;
					} else if(name_len < 2 || name_len > 100) {
						alert("楼盘名称长度错误");
						return false;
					}

					if(add_len == 0) {
						alert("楼盘地址不可为空");
						return false;
					} else if(add_len < 2 || add_len > 50) {
						alert("楼盘地址长度错误");
						return false;
					}
					if(type_len.length == 0) {
						alert("楼盘类型不可为空");
						return false;
					} else if(type_len < 1 || type_len > 8) {
						alert("楼盘类型错误");
						return false;
					}

					if($("#rent_price").val() > 20) {
						alert("租金报价错误");
						return false;
					}
					if($("#ave_sel_price").val() > 20) {
						alert("平均售价错误");
						return false;
					}
					if($("#pm_fee").val() > 20) {
						alert("物业费错误");
						return false;
					}
					var images = [];
					$('#other_imgs .img_del').each(function() {
						images.push(this.getAttribute('imgId'));
					})
					var parm = {
						name: $("#house_name").val(),
						address: $("#house_address").val(),
						type: $("#buildType").attr('tid'),
						rent_price: $("#rent_quote").val(),
						sell_price: $("#ave_sel_price").val(),
						wyf: $("#pm_fee").val(),
						info: localStorage.getItem("house_introduce"),
						pics: images.join(','),
						/*session_id:util.getLocal('sessionId')*/
						session_id: "fi06al2aja0vpgf95r9scc3lv4"
					};
					$.getJSON(add_house_url, parm, function(data) {
						if(data.msg == 'success') {
							alert("楼盘  " + $("#house_name").val() + "  新增成功，我们将尽快生成新的楼盘字典");
							localStorage.removeItem("house_introduce");
							localStorage.removeItem("house_id");
						}
					})

				});
			}
		</script>

		<script src="lxs_scripts_lxsConfig.js"></script>
		<script type="text/tpl">
			<!--^img-->
			<span class="img_span {#imgType}">
                <a href="javascript:;" class="img_del" imgId="{#id}"></a>
                <img src="{#avatar}" />
            </span>
			<!--img$-->
		</script>
	</body>

</html>